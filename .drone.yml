---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push
    - tag

steps:

  - name: audit
    image: node:12
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: install
    image: node:12
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true
    commands:
      - npm ci

  - name: test
    image: node:12
    commands:
      - npm test

  - name: check-coverage
    image: node:12
    commands:
      - npm run coverage

  - name: build
    image: node:12
    commands:
      - npm run build
      - npm ci --production


  - name: static-security-scan
    image: quay.io/natlibfi/njsscan
    commands:
      - njsscan dist

  - name: npm
    image: plugins/npm
    settings:
      registry: 'https://registry.npmjs.org/'
      token:
        from_secret: npm_token
    when:
      event: tag
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:

  - name: publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: npm_token
data: VrCFf0yN7nyxeCxAJhgdxFF2v81mCKWlub4Z7ImZgDJJzIxoRj2wPT4NL28XMq/bpqBglLN8gGFFIrXnqRTAXQ==
---
kind: secret
name: ssh_key
data: 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
---
kind: secret
name: gpg_key
data: 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
---
kind: signature
hmac: 64b0fbb3faac0b0d2954c94303d4c8aa077cc8de60f5dafb36e9352656cfecfc

...
